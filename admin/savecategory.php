<?include("iconnect.php")?><? 	$categoryname = $_POST['categoryname'];	$categoryname=str_replace("'","&#39;",$categoryname);	$categorydesc = $_POST['categorydesc'];	$categorydesc=str_replace("'","&#39;",$categorydesc);	$status = "Active";		  //Take count 	$tcount2001=$obj->totalrecords_condition_nowhere('category','*');	foreach($tcount2001 as $row )	{	$tcount200=$row['count(*)'];	}	if($tcount200=='0') { 	$categoryno=100;	} else 	{  			$sql="SELECT MAX(categoryno) FROM category";	$result=$obj->execute($sql);	foreach($result as $row_100){	$categoryno= $row_100["MAX(categoryno)"]+10;	}	} 		//set priority	$tcount20012=$obj->totalrecords_condition_nowhere('category','*');	foreach($tcount20012 as $row4 )	{	$tcount2001=$row4['count(*)'];	}		if($tcount2001==0) { 	$priority_category=1;	} else 	{  			$sql4="SELECT MAX(priority) FROM category order by priority desc";	$result4=$obj->execute($sql4);	foreach($result4 as $row_1004){	$priority_category= $row_1004["MAX(priority)"]+1;	}	} 	/*----------------------------------------categoryphoto starts----------------------------------------*/      $categoryfilename=$categoryno."_".$priority_category."_".$now;	if((!empty($_FILES["categoryimg"])) && ($_FILES['categoryimg']['error'] == 0))	{		$newfilename= $categoryfilename;		$filename =strtolower(basename($_FILES['categoryimg']['name']));		$ext = substr($filename, strrpos($filename, '.') + 1);		$ext=".".$ext;		$newname = '../categoryimg/'.$newfilename.$ext;		if ((move_uploaded_file($_FILES['categoryimg']['tmp_name'],$newname)))		{			$categoryimg=$newfilename.$ext;			$uploaded=1;			echo $categoryimg;		}		else		{			$categoryimg="";		}	} 	else	{		$categoryimg="";	}/*----------------------------------------categoryphoto starts----------------------------------------*/  /*----------------------------------------categorybanner starts----------------------------------------*/      $categorybannerfilename=$categoryno."_b_".$priority_category."_".$now;	if((!empty($_FILES["categorybanner"])) && ($_FILES['categorybanner']['error'] == 0))	{		$newfilename2= $categorybannerfilename;		$filename =strtolower(basename($_FILES['categorybanner']['name']));		$ext = substr($filename, strrpos($filename, '.') + 1);		$ext=".".$ext;		$newname = '../categorybanner/'.$newfilename2.$ext;		if ((move_uploaded_file($_FILES['categorybanner']['tmp_name'],$newname)))		{			$categorybanner=$newfilename2.$ext;			$uploaded2=1;			echo $categorybanner;		}		else		{			$categorybanner="";		}	} 	else	{		$categorybanner="";	}/*---------------categorybanner starts----------------*/  /*-------------category starts------------------------*/$cnamem = preg_replace('/[^a-zA-Z0-9_ -]/s','',$categoryname);$cnamemask = str_replace(" ","-",$cnamem);		//insert category values	$category_fields="categoryno, categoryname, cnamemask,categoryimg,categorybanner,  categorydesc,priority, status, addedby,addeddate";	$category_values="'$categoryno', '$categoryname', '$cnamemask','$categoryimg','$categorybanner', '$categorydesc','$priority_category', '$status', '$addedbydbsave','$addeddatesave'"; 	$category_result=$obj->insert('category', $category_fields, $category_values);    /*----------------------------------------category ends----------------------------------------*/		if($category_result>0)	{	header("Location:category.php?action=added");	ob_flush(); 	}	else 	{	header("Location:category.php?action=error");	ob_flush(); 	}?>